{% extends "blog/base.html" %}
{% block content %}

  {% if not user.is_authenticated %}
    <!-- Guest View -->
    <div class="jumbotron text-center bg-light p-5 rounded">
      <h1 class="display-4">Welcome to Error Journal ðŸ“”</h1>
      <p class="lead">Your personal developer diary powered by a VS Code extension.  
      Keep track of the errors you face, log solutions, and build your own knowledge base.</p>
      <hr class="my-4">
      <p>Get started by creating an account.</p>
      <a class="btn btn-primary btn-lg" href="{% url 'register' %}">Join Now</a>
      <a class="btn btn-outline-secondary btn-lg" href="{% url 'login' %}">Login</a>
    </div>

  {% elif user.is_authenticated and posts.count == 0 %}
    <!-- Logged in but no posts -->
    <div class="jumbotron text-center bg-light p-5 rounded">
      <h1 class="display-4">Hello {{ user.username }} ðŸ‘‹</h1>
      <p class="lead">Looks like your journal is empty.</p>
      <p>Start by logging your first error and its fix â€”  
      your journey begins here ðŸš€</p>
      <a class="btn btn-success btn-lg" href="{% url 'posts-create' %}">+ Make Your First Error Log</a>
    </div>

  {% else %}
    <!-- Logged in + has posts -->
    <h2 class="mb-4">{{ user.username }}â€™s Error Journal</h2>
    {% for post in posts %}
      <article class="media content-section mb-4 p-3 border rounded shadow-sm">
        <div class="media-body">
          <div class="article-metadata mb-2">
            <small class="text-muted">{{ post.date_posted|date:"F d, Y" }}</small>
          </div>
          <h4><a class="article-title text-dark" href="{% url 'posts-detail' post.id %}">{{ post.title }}</a></h4>
          <p class="article-content">{{ post.content|truncatewords:30 }}</p>
        </div>
      </article>
    {% empty %}
      <p class="text-muted">No entries yet.</p>
    {% endfor %}

    <!-- Pagination -->
    {% if is_paginated %}
      <nav>
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page=1">First</a></li>
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <li class="page-item active"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% endif %}

{% endblock content %}
