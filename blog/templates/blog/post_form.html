{% extends "blog/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<section class="mt-32 max-w-5xl mx-auto px-4 md:px-6 py-8">
  <!-- Page title -->
  <h1 class="text-2xl md:text-3xl font-semibold text-gray-900 mb-6">{% if form.instance.pk %}Edit post{% else %}Create post{% endif %}</h1>

  <form method="POST" class="space-y-8">
    {% csrf_token %}
	

    <!-- Title -->
    <div>
      <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-gray-900">
        Title <span class="text-gray-500">(required)</span>
      </label>
      <input
        type="text"
        name="{{ form.title.html_name }}"
        id="{{ form.title.id_for_label }}"
        value="{{ form.title.value|default_if_none:'' }}"
        class="mt-2 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900
               focus:outline-none focus:ring-0 focus:border-gray-900"
        placeholder="Write a concise title"
      />
      {% if form.title.errors %}
        <p class="mt-2 text-sm text-red-600">{{ form.title.errors|striptags }}</p>
      {% endif %}
    </div>

    <!-- Description editor -->
    <div class="border border-gray-200 rounded-lg overflow-hidden">
      <!-- Tabs -->
      <div class="flex items-center gap-4 px-4 py-2 border-b border-gray-200">
        <button type="button" data-tab="write"
                class="tab-btn px-3 py-1.5 text-sm rounded border border-transparent text-gray-900">
          Write
        </button>
        <button type="button" data-tab="preview"
                class="tab-btn px-3 py-1.5 text-sm rounded border border-transparent text-gray-500">
          Preview
        </button>
      </div>

      <!-- Toolbar placeholder (thin line feel) -->
      <div class="px-4 py-2 border-b border-gray-200 text-xs text-gray-500">
        Basic markdown supported
      </div>

      <!-- Panels -->
      <div class="p-4">
        <!-- Write panel -->
        <div data-panel="write">
          <label for="{{ form.content.id_for_label }}" class="sr-only">Description</label>
          <textarea
            name="{{ form.content.html_name }}"
            id="{{ form.content.id_for_label }}"
            rows="10"
            class="block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900
                   focus:outline-none focus:ring-0 focus:border-gray-900"
            placeholder="Describe the change, issue, or note in detail">{{ form.content.value|default_if_none:'' }}</textarea>
          {% if form.content.errors %}
            <p class="mt-2 text-sm text-red-600">{{ form.content.errors|striptags }}</p>
          {% endif %}
        </div>

        <!-- Preview panel -->
        <div data-panel="preview" class="hidden">
          <div class="prose max-w-none text-gray-800" id="preview-box"></div>
        </div>
      </div>
    </div>

    <!-- Footer actions -->
    <div class="flex items-center justify-end gap-3">
      <a href="javascript:history.back()"
         class="inline-flex items-center justify-center px-4 py-2 rounded border border-gray-300 text-gray-700 hover:bg-gray-50">
        Cancel
      </a>
      <button type="submit"
              class="inline-flex items-center justify-center px-4 py-2 rounded bg-gray-900 text-white hover:bg-gray-800">
        {% if form.instance.pk %}Save changes{% else %}Create{% endif %}
      </button>
    </div>
  </form>
</section>

<!-- Tiny tabs + preview script -->
<script>
  (function () {
    const tabs = document.querySelectorAll('.tab-btn');
    const panels = {
      write: document.querySelector('[data-panel="write"]'),
      preview: document.querySelector('[data-panel="preview"]'),
    };
    const textarea = document.getElementById('{{ form.content.id_for_label }}');
    const preview = document.getElementById('preview-box');

    function activate(tab) {
      tabs.forEach(b => {
        const active = b.getAttribute('data-tab') === tab;
        b.classList.toggle('text-gray-900', active);
        b.classList.toggle('text-gray-500', !active);
        b.classList.toggle('border-gray-300', active);
      });
      panels.write.classList.toggle('hidden', tab !== 'write');
      panels.preview.classList.toggle('hidden', tab !== 'preview');
      if (tab === 'preview') {
        // Simple preview (no markdown parse): escape & newlines
        const text = (textarea.value || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
                                           .replace(/\n/g,'<br>');
        preview.innerHTML = text;
      }
    }

    tabs.forEach(b => b.addEventListener('click', () => activate(b.getAttribute('data-tab'))));
    activate('write');
  })();
</script>
{% endblock content %}

